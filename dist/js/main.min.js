"use strict";var boardArr,board=document.querySelector(".board"),rowsCount=4,columnsCount=4,handlePrepareGame=function(){boardArr=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];for(var r=0;r<rowsCount;r++){var e=document.createElement("div");e.classList.add("row");for(var o=0;o<columnsCount;o++){var t=document.createElement("div"),a=(t.setAttribute("id","".concat(r,"-").concat(o)),e.append(t),boardArr[r][o]);handleUpdateTile(t,a),board.appendChild(e)}}addNextValue(),addNextValue()},empty=function(){for(var r=0;r<rowsCount;r++)for(var e=0;e<columnsCount;e++)if(0==boardArr[r][e])return!0;return!1},addNextValue=function(){if(empty)for(var r=!1;!r;){var e=Math.floor(4*Math.random()),o=Math.floor(4*Math.random());0==boardArr[o][e]&&(boardArr[o][e]=2,(o=document.getElementById("".concat(o,"-").concat(e))).innerText="2",o.classList.add("x2"),o.classList.add("tile-animation"),r=!0)}},checkMove=function(r){"ArrowLeft"===r.key?(leftMove(),addNextValue()):"ArrowRight"===r.key?(rightMove(),addNextValue()):"ArrowUp"===r.key?(upMove(),addNextValue()):"ArrowDown"===r.key&&(downMove(),addNextValue())},clearZeros=function(r){return r.filter(function(r){return 0!=r})},handleUpdateTile=function(r,e){r.textContent="",r.classList.value="",r.classList.add("tile"),0!==e&&(r.textContent=e,r.classList.add("tile-animation"),e<=2048)&&r.classList.add("x".concat(e))},leftMove=function(){for(var r=0;r<rowsCount;r++){for(var e=boardArr[r],e=clearZeros(e),o=0;o<e.length-1;o++)e[o]===e[o+1]&&(e[o]*=2,e[o+1]=0);for(e=clearZeros(e);e.length<rowsCount;)e.push(0);boardArr[r]=e;for(var t=0;t<rowsCount;t++){var a=document.getElementById("".concat(r,"-").concat(t)),n=boardArr[r][t];handleUpdateTile(a,n)}}},rightMove=function(){for(var r=0;r<rowsCount;r++){(e=boardArr[r]).reverse();for(var e=clearZeros(e),o=0;o<e.length-1;o++)e[o]===e[o+1]&&(e[o]*=2,e[o+1]=0);for(e=clearZeros(e);e.length<rowsCount;)e.push(0);e.reverse(),boardArr[r]=e;for(var t=0;t<rowsCount;t++){var a=document.getElementById("".concat(r,"-").concat(t)),n=boardArr[r][t];handleUpdateTile(a,n)}}},upMove=function(){for(var r=0;r<columnsCount;r++){for(var e=[boardArr[0][r],boardArr[1][r],boardArr[2][r],boardArr[3][r]],e=clearZeros(e),o=0;o<e.length-1;o++)e[o]===e[o+1]&&(e[o]*=2,e[o+1]=0);for(e=clearZeros(e);e.length<rowsCount;)e.push(0);for(var t=0;t<rowsCount;t++){boardArr[t][r]=e[t];var a=document.getElementById("".concat(t,"-").concat(r)),n=boardArr[t][r];handleUpdateTile(a,n)}}},downMove=function(){for(var r=0;r<columnsCount;r++){(e=[boardArr[0][r],boardArr[1][r],boardArr[2][r],boardArr[3][r]]).reverse();for(var e=clearZeros(e),o=0;o<e.length-1;o++)e[o]===e[o+1]&&(e[o]*=2,e[o+1]=0);for(e=clearZeros(e);e.length<rowsCount;)e.push(0);e.reverse();for(var t=0;t<rowsCount;t++){boardArr[t][r]=e[t];var a=document.getElementById("".concat(t,"-").concat(r)),n=boardArr[t][r];handleUpdateTile(a,n)}}},websiteLoaded=function(){handlePrepareGame()},leftArrow=(window.addEventListener("DOMContentLoaded",websiteLoaded),document.addEventListener("keyup",checkMove),document.querySelector(".arrow-left")),rightArrow=document.querySelector(".arrow-right"),upArrow=document.querySelector(".arrow-up"),downArrow=document.querySelector(".arrow-down");leftArrow.addEventListener("click",function(){leftMove(),addNextValue()}),rightArrow.addEventListener("click",function(){rightMove(),addNextValue()}),upArrow.addEventListener("click",function(){upMove(),addNextValue()}),downArrow.addEventListener("click",function(){downMove(),addNextValue()});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsicm93c0NvdW50IiwiYm9hcmQiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJib2FyZEFyciIsImhhbmRsZVByZXBhcmVHYW1lIiwibmV3Um93IiwiY2xhc3NMaXN0IiwibmV3VGlsZSIsInNldEF0dHJpYnV0ZSIsInIiLCJjb25jYXQiLCJhcHBlbmQiLCJjIiwiaGFuZGxlVXBkYXRlVGlsZSIsImNvbHVtbnNDb3VudCIsImFwcGVuZENoaWxkIiwiYWRkTmV4dFZhbHVlIiwibnVtIiwiZW1wdHkiLCJmb3VuZCIsIk1hdGgiLCJyYW5kb21Db2x1bW4iLCJmbG9vciIsInJhbmRvbSIsInJhbmRvbVJvdyIsImNoZWNrTW92ZSIsImxlZnRNb3ZlIiwiZ2V0RWxlbWVudEJ5SWQiLCJ0aWxlIiwiYWRkIiwicmlnaHRNb3ZlIiwiZSIsImtleSIsInJvd3MiLCJmaWx0ZXIiLCJpdGVtIiwidXBNb3ZlIiwidGV4dENvbnRlbnQiLCJpIiwiY2xlYXJaZXJvcyIsImEiLCJnIiwibGVuZ3RoIiwicHVzaCIsInJldmVyc2UiLCJyb3ciLCJwIiwiZG93bk1vdmUiLCJ3ZWJzaXRlTG9hZGVkIiwiYWRkRXZlbnRMaXN0ZW5lciIsImxlZnRBcnJvdyIsImRvd25BcnJvdyIsIndpbmRvdyIsInJpZ2h0QXJyb3ciLCJ1cEFycm93Il0sIm1hcHBpbmdzIjoiYUFBQSxJQUNNQSxTQURBQyxNQUFRQyxTQUFTQyxjQUFjLFFBQVEsRUFDdkNILFVBQVksRUFEWkMsYUFBaUJFLEVBR25CQyxrQkFBUSxXQUVaQSxTQUFNQyxDQUNMRCxDQUFBQSxFQUFBQSxFQUFBQSxFQUFRLEdBT1IsQ0FBQSxFQUFBLEVBQUssRUFBSyxHQUpULENBQUMsRUFLRCxFQUFNRSxFQUFBQSxHQUpOLENBQUMsRUFLREEsRUFBQUEsRUFBT0MsSUFGUixJQUtFQyxJQUFBQSxFQUFRQyxFQUFBQSxFQUFBQSxVQUFpQkMsQ0FBQSxHQUFBQyxDQUoxQixJQUtDTCxFQUFPTSxTQUFP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QUFBLEdBQVl5QixHQUFFSSxFQUFBQyxHQUNiLElBQUFsQixFQUFBM0IsU0FBQTBCLGVBQUEsR0FBQWpCLE9BQUFvQyxFQUFBLEdBQUEsRUFBQXBDLE9BQUErQixDQUFBLENBQUEsRUFDS3hCLEVBQUNnQyxTQUFBQSxHQUFpQlIsR0FDeEJMLGlCQUFRUixFQUFBWCxDQUFBLENBQ1JELENBQ0EsQ0FDRG1DLEVBRUNuQyxjQUFjLFdBQ2RaLGtCQUFDLENBMUJGLEVBTU04QyxXQUpORSxPQUFPSCxpQkFBaUIsbUJBQW9CRCxhQUFhLEVBRXpEL0MsU0FBU2dELGlCQUFpQixRQUFTeEIsU0FBUyxFQUUxQnhCLFNBQVNDLGNBQWMsYUFBYSxHQUNoRG1ELFdBQWFwRCxTQUFTQyxjQUFjLGNBQWMsRUFDbERvRCxRQUFVckQsU0FBU0MsY0FBYyxXQUFXLEVBQzVDaUQsVUFBWWxELFNBQVNDLGNBQWMsYUFBYSxFQUV0RGdELFVBQVVELGlCQUFpQixRQUFTLFdBQ25DdkIsU0FBUSxFQUNSVixhQUFZLENBQ2IsQ0FBQyxFQUNEcUMsV0FBV0osaUJBQWlCLFFBQVMsV0FDcENuQixVQUFTLEVBQ1RkLGFBQVksQ0FDYixDQUFDLEVBQ0RzQyxRQUFRTCxpQkFBaUIsUUFBUyxXQUNqQ2IsT0FBTSxFQUNOcEIsYUFBWSxDQUNiLENBQUMsRUFDRG1DLFVBQVVGLGlCQUFpQixRQUFTLFdBQ25DRixTQUFRLEVBQ1IvQixhQUFZLENBQ2IsQ0FBQyIsImZpbGUiOiJtYWluLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGJvYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJvYXJkJyk7XHJcbmNvbnN0IHJvd3NDb3VudCA9IDQ7XHJcbmNvbnN0IGNvbHVtbnNDb3VudCA9IDQ7XHJcbmxldCBib2FyZEFycjtcclxuXHJcbmNvbnN0IGhhbmRsZVByZXBhcmVHYW1lID0gKCkgPT4ge1xyXG5cdGJvYXJkQXJyID0gW1xyXG5cdFx0WzAsIDAsIDAsIDBdLFxyXG5cdFx0WzAsIDAsIDAsIDBdLFxyXG5cdFx0WzAsIDAsIDAsIDBdLFxyXG5cdFx0WzAsIDAsIDAsIDBdLFxyXG5cdF07XHJcblxyXG5cdGZvciAobGV0IHIgPSAwOyByIDwgcm93c0NvdW50OyByKyspIHtcclxuXHRcdGNvbnN0IG5ld1JvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG5cdFx0bmV3Um93LmNsYXNzTGlzdC5hZGQoJ3JvdycpO1xyXG5cdFx0Zm9yIChsZXQgYyA9IDA7IGMgPCBjb2x1bW5zQ291bnQ7IGMrKykge1xyXG5cdFx0XHRsZXQgbmV3VGlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG5cdFx0XHRuZXdUaWxlLnNldEF0dHJpYnV0ZSgnaWQnLCBgJHtyfS0ke2N9YCk7XHJcblx0XHRcdG5ld1Jvdy5hcHBlbmQobmV3VGlsZSk7XHJcblx0XHRcdGxldCBudW0gPSBib2FyZEFycltyXVtjXTtcclxuXHRcdFx0aGFuZGxlVXBkYXRlVGlsZShuZXdUaWxlLCBudW0pO1xyXG5cdFx0XHRib2FyZC5hcHBlbmRDaGlsZChuZXdSb3cpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0YWRkTmV4dFZhbHVlKCk7XHJcblx0YWRkTmV4dFZhbHVlKCk7XHJcbn07XHJcblxyXG5jb25zdCBlbXB0eSA9ICgpID0+IHtcclxuXHRmb3IgKGxldCByID0gMDsgciA8IHJvd3NDb3VudDsgcisrKSB7XHJcblx0XHRmb3IgKGxldCBjID0gMDsgYyA8IGNvbHVtbnNDb3VudDsgYysrKSB7XHJcblx0XHRcdGlmIChib2FyZEFycltyXVtjXSA9PSAwKSB7XHJcblx0XHRcdFx0cmV0dXJuIHRydWU7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblx0cmV0dXJuIGZhbHNlO1xyXG59O1xyXG5cclxuY29uc3QgYWRkTmV4dFZhbHVlID0gKCkgPT4ge1xyXG5cdGlmICghZW1wdHkpIHtcclxuXHRcdC8vIGNvbnNvbGUubG9nKCd5b3UgbG9vc2UnKVxyXG5cdFx0cmV0dXJuO1xyXG5cdH0gXHJcblxyXG5cdGxldCBmb3VuZCA9IGZhbHNlO1xyXG5cdHdoaWxlICghZm91bmQpIHtcclxuXHRcdGxldCByYW5kb21Db2x1bW4gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA0KTtcclxuXHRcdGxldCByYW5kb21Sb3cgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA0KTtcclxuXHJcblx0XHRpZiAoYm9hcmRBcnJbcmFuZG9tUm93XVtyYW5kb21Db2x1bW5dID09IDApIHtcclxuXHRcdFx0Ym9hcmRBcnJbcmFuZG9tUm93XVtyYW5kb21Db2x1bW5dID0gMjtcclxuXHRcdFx0bGV0IHRpbGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgJHtyYW5kb21Sb3d9LSR7cmFuZG9tQ29sdW1ufWApO1xyXG5cdFx0XHR0aWxlLmlubmVyVGV4dCA9ICcyJztcclxuXHRcdFx0dGlsZS5jbGFzc0xpc3QuYWRkKCd4MicpO1xyXG5cdFx0XHR0aWxlLmNsYXNzTGlzdC5hZGQoJ3RpbGUtYW5pbWF0aW9uJyk7XHJcblxyXG5cdFx0XHRmb3VuZCA9IHRydWU7XHJcblx0XHR9XHJcblx0fVxyXG59O1xyXG5cclxuY29uc3QgY2hlY2tNb3ZlID0gKGUpID0+IHtcclxuXHRpZiAoZS5rZXkgPT09ICdBcnJvd0xlZnQnKSB7XHJcblx0XHRsZWZ0TW92ZSgpO1xyXG5cdFx0YWRkTmV4dFZhbHVlKCk7XHJcblx0fSBlbHNlIGlmIChlLmtleSA9PT0gJ0Fycm93UmlnaHQnKSB7XHJcblx0XHRyaWdodE1vdmUoKTtcclxuXHRcdGFkZE5leHRWYWx1ZSgpO1xyXG5cdH0gZWxzZSBpZiAoZS5rZXkgPT09ICdBcnJvd1VwJykge1xyXG5cdFx0dXBNb3ZlKCk7XHJcblx0XHRhZGROZXh0VmFsdWUoKTtcclxuXHR9IGVsc2UgaWYgKGUua2V5ID09PSAnQXJyb3dEb3duJykge1xyXG5cdFx0ZG93bk1vdmUoKTtcclxuXHRcdGFkZE5leHRWYWx1ZSgpO1xyXG5cdH1cclxufTtcclxuXHJcbmNvbnN0IGNsZWFyWmVyb3MgPSAocm93cykgPT4ge1xyXG5cdHJldHVybiByb3dzLmZpbHRlcigoaXRlbSkgPT4gaXRlbSAhPSAwKTtcclxufTtcclxuXHJcbmNvbnN0IGhhbmRsZVVwZGF0ZVRpbGUgPSAodGlsZSwgbnVtKSA9PiB7XHJcblx0dGlsZS50ZXh0Q29udGVudCA9ICcnO1xyXG5cdHRpbGUuY2xhc3NMaXN0LnZhbHVlID0gJyc7XHJcblx0dGlsZS5jbGFzc0xpc3QuYWRkKCd0aWxlJyk7XHJcblx0aWYgKG51bSAhPT0gMCkge1xyXG5cdFx0dGlsZS50ZXh0Q29udGVudCA9IG51bTtcclxuXHRcdHRpbGUuY2xhc3NMaXN0LmFkZCgndGlsZS1hbmltYXRpb24nKTtcclxuXHRcdGlmIChudW0gPD0gMjA0OCkge1xyXG5cdFx0XHR0aWxlLmNsYXNzTGlzdC5hZGQoYHgke251bX1gKTtcclxuXHRcdH1cclxuXHR9XHJcbn07XHJcblxyXG5jb25zdCBsZWZ0TW92ZSA9ICgpID0+IHtcclxuXHRmb3IgKGxldCBpID0gMDsgaSA8IHJvd3NDb3VudDsgaSsrKSB7XHJcblx0XHRsZXQgcm93cyA9IGJvYXJkQXJyW2ldO1xyXG5cdFx0cm93cyA9IGNsZWFyWmVyb3Mocm93cyk7XHJcblx0XHRmb3IgKGxldCBhID0gMDsgYSA8IHJvd3MubGVuZ3RoIC0gMTsgYSsrKSB7XHJcblx0XHRcdGlmIChyb3dzW2FdID09PSByb3dzW2EgKyAxXSkge1xyXG5cdFx0XHRcdHJvd3NbYV0gKj0gMjtcclxuXHRcdFx0XHRyb3dzW2EgKyAxXSA9IDA7XHJcblx0XHRcdH0gXHJcblx0XHR9XHJcblxyXG5cdFx0cm93cyA9IGNsZWFyWmVyb3Mocm93cyk7XHJcblxyXG5cdFx0d2hpbGUgKHJvd3MubGVuZ3RoIDwgcm93c0NvdW50KSB7XHJcblx0XHRcdHJvd3MucHVzaCgwKTtcclxuXHRcdH1cclxuXHJcblx0XHRib2FyZEFycltpXSA9IHJvd3M7XHJcblxyXG5cdFx0Zm9yIChsZXQgZyA9IDA7IGcgPCByb3dzQ291bnQ7IGcrKykge1xyXG5cdFx0XHRsZXQgdGlsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke2l9LSR7Z31gKTtcclxuXHRcdFx0bGV0IG51bSA9IGJvYXJkQXJyW2ldW2ddO1xyXG5cdFx0XHRoYW5kbGVVcGRhdGVUaWxlKHRpbGUsIG51bSk7XHJcblx0XHR9XHJcblx0fVxyXG59O1xyXG5cclxuY29uc3QgcmlnaHRNb3ZlID0gKCkgPT4ge1xyXG5cdGZvciAobGV0IGkgPSAwOyBpIDwgcm93c0NvdW50OyBpKyspIHtcclxuXHRcdGxldCByb3dzID0gYm9hcmRBcnJbaV07XHJcblx0XHRyb3dzLnJldmVyc2UoKTtcclxuXHRcdHJvd3MgPSBjbGVhclplcm9zKHJvd3MpO1xyXG5cdFx0Zm9yIChsZXQgYSA9IDA7IGEgPCByb3dzLmxlbmd0aCAtIDE7IGErKykge1xyXG5cdFx0XHRpZiAocm93c1thXSA9PT0gcm93c1thICsgMV0pIHtcclxuXHRcdFx0XHRyb3dzW2FdICo9IDI7XHJcblx0XHRcdFx0cm93c1thICsgMV0gPSAwO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRyb3dzID0gY2xlYXJaZXJvcyhyb3dzKTtcclxuXHRcdHdoaWxlIChyb3dzLmxlbmd0aCA8IHJvd3NDb3VudCkge1xyXG5cdFx0XHRyb3dzLnB1c2goMCk7XHJcblx0XHR9XHJcblx0XHRyb3dzLnJldmVyc2UoKTtcclxuXHRcdGJvYXJkQXJyW2ldID0gcm93cztcclxuXHJcblx0XHRmb3IgKGxldCBnID0gMDsgZyA8IHJvd3NDb3VudDsgZysrKSB7XHJcblx0XHRcdGxldCB0aWxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7aX0tJHtnfWApO1xyXG5cdFx0XHRsZXQgbnVtID0gYm9hcmRBcnJbaV1bZ107XHJcblx0XHRcdGhhbmRsZVVwZGF0ZVRpbGUodGlsZSwgbnVtKTtcclxuXHRcdH1cclxuXHR9XHJcbn07XHJcblxyXG5jb25zdCB1cE1vdmUgPSAoKSA9PiB7XHJcblx0Zm9yIChsZXQgZyA9IDA7IGcgPCBjb2x1bW5zQ291bnQ7IGcrKykge1xyXG5cdFx0bGV0IHJvdyA9IFtib2FyZEFyclswXVtnXSwgYm9hcmRBcnJbMV1bZ10sIGJvYXJkQXJyWzJdW2ddLCBib2FyZEFyclszXVtnXV07XHJcblx0XHRyb3cgPSBjbGVhclplcm9zKHJvdyk7XHJcblx0XHRmb3IgKGxldCBhID0gMDsgYSA8IHJvdy5sZW5ndGggLSAxOyBhKyspIHtcclxuXHRcdFx0aWYgKHJvd1thXSA9PT0gcm93W2EgKyAxXSkge1xyXG5cdFx0XHRcdHJvd1thXSAqPSAyO1xyXG5cdFx0XHRcdHJvd1thICsgMV0gPSAwO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRyb3cgPSBjbGVhclplcm9zKHJvdyk7XHJcblx0XHR3aGlsZSAocm93Lmxlbmd0aCA8IHJvd3NDb3VudCkge1xyXG5cdFx0XHRyb3cucHVzaCgwKTtcclxuXHRcdH1cclxuXHJcblx0XHRmb3IgKGxldCBwID0gMDsgcCA8IHJvd3NDb3VudDsgcCsrKSB7XHJcblx0XHRcdGJvYXJkQXJyW3BdW2ddID0gcm93W3BdO1xyXG5cdFx0XHRsZXQgdGlsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke3B9LSR7Z31gKTtcclxuXHRcdFx0bGV0IG51bSA9IGJvYXJkQXJyW3BdW2ddO1xyXG5cdFx0XHRoYW5kbGVVcGRhdGVUaWxlKHRpbGUsIG51bSk7XHJcblx0XHR9XHJcblx0fVxyXG59O1xyXG5jb25zdCBkb3duTW92ZSA9ICgpID0+IHtcclxuXHRmb3IgKGxldCBnID0gMDsgZyA8IGNvbHVtbnNDb3VudDsgZysrKSB7XHJcblx0XHRsZXQgcm93ID0gW2JvYXJkQXJyWzBdW2ddLCBib2FyZEFyclsxXVtnXSwgYm9hcmRBcnJbMl1bZ10sIGJvYXJkQXJyWzNdW2ddXTtcclxuXHRcdHJvdy5yZXZlcnNlKCk7XHJcblx0XHRyb3cgPSBjbGVhclplcm9zKHJvdyk7XHJcblx0XHRmb3IgKGxldCBhID0gMDsgYSA8IHJvdy5sZW5ndGggLSAxOyBhKyspIHtcclxuXHRcdFx0aWYgKHJvd1thXSA9PT0gcm93W2EgKyAxXSkge1xyXG5cdFx0XHRcdHJvd1thXSAqPSAyO1xyXG5cdFx0XHRcdHJvd1thICsgMV0gPSAwO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRyb3cgPSBjbGVhclplcm9zKHJvdyk7XHJcblx0XHR3aGlsZSAocm93Lmxlbmd0aCA8IHJvd3NDb3VudCkge1xyXG5cdFx0XHRyb3cucHVzaCgwKTtcclxuXHRcdH1cclxuXHRcdHJvdy5yZXZlcnNlKCk7XHJcblxyXG5cdFx0Zm9yIChsZXQgcCA9IDA7IHAgPCByb3dzQ291bnQ7IHArKykge1xyXG5cdFx0XHRib2FyZEFycltwXVtnXSA9IHJvd1twXTtcclxuXHRcdFx0bGV0IHRpbGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgJHtwfS0ke2d9YCk7XHJcblx0XHRcdGxldCBudW0gPSBib2FyZEFycltwXVtnXTtcclxuXHRcdFx0aGFuZGxlVXBkYXRlVGlsZSh0aWxlLCBudW0pO1xyXG5cdFx0fVxyXG5cdH1cclxufTtcclxuXHJcbmNvbnN0IHdlYnNpdGVMb2FkZWQgPSAoKSA9PiB7XHJcblx0aGFuZGxlUHJlcGFyZUdhbWUoKTtcclxufTtcclxuXHJcbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgd2Vic2l0ZUxvYWRlZCk7XHJcblxyXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIGNoZWNrTW92ZSk7XHJcblxyXG5jb25zdCBsZWZ0QXJyb3cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYXJyb3ctbGVmdCcpO1xyXG5jb25zdCByaWdodEFycm93ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmFycm93LXJpZ2h0Jyk7XHJcbmNvbnN0IHVwQXJyb3cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYXJyb3ctdXAnKTtcclxuY29uc3QgZG93bkFycm93ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmFycm93LWRvd24nKTtcclxuXHJcbmxlZnRBcnJvdy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcclxuXHRsZWZ0TW92ZSgpO1xyXG5cdGFkZE5leHRWYWx1ZSgpO1xyXG59KTtcclxucmlnaHRBcnJvdy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcclxuXHRyaWdodE1vdmUoKTtcclxuXHRhZGROZXh0VmFsdWUoKTtcclxufSk7XHJcbnVwQXJyb3cuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcblx0dXBNb3ZlKCk7XHJcblx0YWRkTmV4dFZhbHVlKCk7XHJcbn0pO1xyXG5kb3duQXJyb3cuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcblx0ZG93bk1vdmUoKTtcclxuXHRhZGROZXh0VmFsdWUoKTtcclxufSk7XHJcbiJdfQ==
